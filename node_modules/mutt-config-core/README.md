# mutt-config-core

Pure configuration generator for Neomutt + Gmail + OAuth2.0

[![npm version](https://badge.fury.io/js/mutt-config-core.svg)](https://www.npmjs.com/package/mutt-config-core)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## Features

- ✅ **Zero dependencies** - Pure JavaScript, no external packages
- ✅ **Pure functions** - No side effects, easy to test
- ✅ **Fully tested** - 24 test cases, 100% coverage
- ✅ **Type-safe** - JSDoc type definitions included
- ✅ **i18n support** - Japanese and English Gmail folders
- ✅ **GPG ready** - Pre-configured for GPG encryption

## Installation

```bash
npm install mutt-config-core
```

## Quick Start

```javascript
const { generateMuttConfigs } = require('mutt-config-core');

const configs = generateMuttConfigs({
  email: 'your-email@gmail.com',
  realName: 'Your Name',
  editor: 'nvim',
  locale: 'ja'  // or 'en'
});

console.log(configs.accountMuttrc);  // Account-specific config
console.log(configs.mainMuttrc);     // Main muttrc
console.log(configs.setupGuide);     // Next steps guide
```

## API Reference

### `generateMuttConfigs(input)`

Generates all necessary Neomutt configuration files for Gmail with OAuth2.0.

#### Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `email` | `string` | Yes | Gmail address (must end with @gmail.com) |
| `realName` | `string` | Yes | Your real name for email headers |
| `editor` | `string` | Yes | Editor command (e.g., 'nvim', 'vim', 'emacs') |
| `locale` | `'ja' \| 'en'` | Yes | Gmail language setting |
| `gpgKeyId` | `string` | No | GPG key ID (defaults to email address) |

#### Returns

```typescript
{
  accountMuttrc: string,  // Account-specific configuration
  mainMuttrc: string,     // Main muttrc file
  setupGuide: string      // Step-by-step setup instructions
}
```

#### Example

```javascript
const configs = generateMuttConfigs({
  email: 'john.doe@gmail.com',
  realName: 'John Doe',
  editor: 'nvim',
  locale: 'en',
  gpgKeyId: 'john.doe@example.com'  // optional
});
```

### `getConfigPaths(email)`

Returns recommended file paths for configuration files.

#### Parameters

- `email` (string): Gmail address

#### Returns

```javascript
{
  accountMuttrc: '.config/mutt/accounts/EMAIL.muttrc',
  mainMuttrc: '.config/mutt/muttrc',
  oauthTokens: '.local/etc/oauth-tokens',
  cacheHeaders: '.cache/mutt/headers',
  cacheBodies: '.cache/mutt/bodies'
}
```

### `GMAIL_FOLDERS`

Gmail folder names for different locales.

```javascript
{
  ja: {
    drafts: '下書き',
    sent: '送信済みメール',
    trash: 'ゴミ箱',
    allMail: 'すべてのメール'
  },
  en: {
    drafts: 'Drafts',
    sent: 'Sent Mail',
    trash: 'Trash',
    allMail: 'All Mail'
  }
}
```

## Generated Configuration

The generated configuration includes:

- **OAuth 2.0 authentication** - Uses GPG-encrypted tokens
- **IMAP/SMTP settings** - Optimized for Gmail
- **Performance settings** - Caching and connection keepalive
- **Folder macros** - Quick navigation with `gi`, `gt`, `gs`, `gd`, `ga`
- **Locale-specific folders** - Correct folder names for Japanese/English

## Prerequisites

Before using the generated configuration, ensure you have:

- [Neomutt](https://neomutt.org/) installed
- [mutt-wizard](https://github.com/LukeSmithxyz/mutt-wizard) installed
- Python 3 with `mutt_oauth2.py`
- GPG configured
- Google Cloud OAuth 2.0 credentials

See the generated `setupGuide` for detailed instructions.

## Use Cases

### CLI Tool

Perfect for building command-line setup tools:

```javascript
const inquirer = require('inquirer');
const fs = require('fs').promises;
const { generateMuttConfigs, getConfigPaths } = require('mutt-config-core');

const answers = await inquirer.prompt([...]);
const configs = generateMuttConfigs(answers);
const paths = getConfigPaths(answers.email);

// Write configs to disk
await fs.writeFile(paths.accountMuttrc, configs.accountMuttrc);
```

### Web Service

Generate configurations on-demand:

```javascript
app.post('/generate-config', (req, res) => {
  const configs = generateMuttConfigs(req.body);
  res.json(configs);
});
```

### Testing

Easy to test due to pure functions:

```javascript
test('generates valid config', () => {
  const result = generateMuttConfigs({
    email: 'test@gmail.com',
    realName: 'Test User',
    editor: 'vim',
    locale: 'en'
  });
  
  expect(result.accountMuttrc).toContain('test@gmail.com');
});
```

## Development

```bash
# Install dependencies
npm install

# Run tests
npm test

# Watch mode
npm run test:watch

# Coverage report
npm run test:coverage
```

## Related Projects

- [mutt-wizard](https://github.com/LukeSmithxyz/mutt-wizard) - Script for easy Neomutt setup
- [neomutt](https://github.com/neomutt/neomutt) - Command line email client

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## License

MIT © a-lost-social-misfit

## Author

Created by [a-lost-social-misfit](https://github.com/a-lost-social-misfit)

Based on practical experience setting up Neomutt with Gmail OAuth2.0 on macOS.

## Acknowledgments

- Inspired by the [mutt-wizard project](https://github.com/LukeSmithxyz/mutt-wizard)
- OAuth2 implementation based on [mutt_oauth2.py](https://github.com/neomutt/neomutt/blob/main/contrib/oauth2/mutt_oauth2.py)

**Returns:**
- `accountMuttrc` (string): Account-specific configuration
- `mainMuttrc` (string): Main muttrc file
- `setupGuide` (string): Next steps guide

### `getConfigPaths(email)`

Returns file paths for configuration files.

### `GMAIL_FOLDERS`

Gmail folder names for different locales.

## Development
```bash
# Run tests
npm test

# Watch mode
npm run test:watch

# Coverage
npm run test:coverage
```

## License

MIT
